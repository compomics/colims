<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
    <sql-query name="Protein.getConstraintLessProteinIdsForRuns">
        SELECT
        DISTINCT protein.id
        from protein
        LEFT JOIN protein_group_has_protein ON protein_group_has_protein.l_protein_id = protein.id
        AND protein_group_has_protein.id NOT IN
        (
        SELECT
        DISTINCT pg_has_p.id
        FROM protein_group_has_protein pg_has_p
        JOIN peptide_has_protein_group p_has_pg ON p_has_pg.l_protein_group_id = pg_has_p.l_protein_group_id
        JOIN peptide pep ON pep.id = p_has_pg.l_peptide_id
        JOIN spectrum sp ON sp.id = pep.l_spectrum_id
        WHERE sp.l_analytical_run_id IN (:ids)
        )
        WHERE protein_group_has_protein.l_protein_id IS NULL
    </sql-query>
</hibernate-mapping>