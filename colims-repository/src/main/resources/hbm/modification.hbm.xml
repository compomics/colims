<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
    <sql-query name="Modification.getConstraintLessModificationIdsForRuns">
        SELECT
        DISTINCT modification.id
        FROM modification
        LEFT JOIN peptide_has_modification ON peptide_has_modification.l_modification_id = modification.id
        AND peptide_has_modification.id NOT IN
        (
        SELECT
        pep_has_mod.id
        FROM peptide_has_modification pep_has_mod
        JOIN peptide pep ON pep.id = pep_has_mod.l_peptide_id
        JOIN spectrum sp ON sp.id = pep.l_spectrum_id
        WHERE sp.l_analytical_run_id IN (:ids)
        )
        WHERE peptide_has_modification.l_modification_id IS NULL
    </sql-query>
</hibernate-mapping>